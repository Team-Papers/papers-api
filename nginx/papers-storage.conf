# =============================================================================
# PAPERS STORAGE - Nginx Configuration
# =============================================================================
# Ce fichier configure le serveur Nginx pour servir les fichiers médias
#
# Installation:
# 1. Copier ce fichier dans /etc/nginx/sites-available/
# 2. Créer un lien symbolique: ln -s /etc/nginx/sites-available/papers-storage.conf /etc/nginx/sites-enabled/
# 3. Tester la configuration: nginx -t
# 4. Recharger Nginx: systemctl reload nginx
# =============================================================================

# Servir les couvertures de livres (public)
location /media/covers/ {
    alias /var/www/papers-storage/covers/;

    # Cache agressif (les images ne changent pas)
    expires 1y;
    add_header Cache-Control "public, immutable";

    # Sécurité
    add_header X-Content-Type-Options "nosniff";

    # Types MIME autorisés
    types {
        image/jpeg jpg jpeg;
        image/png png;
        image/webp webp;
    }

    # Compression désactivée pour les images (déjà compressées)
    gzip off;

    # Limiter l'accès aux fichiers images uniquement
    location ~ \.(jpg|jpeg|png|webp)$ {
        try_files $uri =404;
    }

    # Bloquer tout autre type de fichier
    location ~ ^/media/covers/.*$ {
        return 403;
    }
}

# IMPORTANT: Ne PAS exposer /var/www/papers-storage/books/
# Les fichiers livres sont servis uniquement via l'API avec tokens signés
